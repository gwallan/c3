<html>
  <head>
    <link href="../../css/c3.css" rel="stylesheet" type="text/css">
    <style>
      html,body{
        position: relative;
        height: 100%;
      }
      #chart{
        position: absolute;
        width: 50%;
        height: 50%;
      }
      .c3-chart-treemap-node text{
        font-size: 14px;
        /*dominant-baseline: middle;*/
      }
    </style>
  </head>
  <body>
    <script src="//cdn.bootcss.com/jquery/2.2.2/jquery.js"></script>
    <div id="chart"></div>

    <script src="../../js/system.js"></script>
    <script>
    System.defaultJSExtensions = true;
    // set our baseURL reference path
    System.config({
        baseURL: '../../../src/',
        meta: {
            'c3.js': {
            format: 'cjs'
            }
        },
        map: {
            "underscore": "../../../node_modules/underscore/underscore.js",
            "pathseg": "../../../node_modules/pathseg/pathseg.js",
            "d3": "../../../node_modules/d3/d3.js",
            "d3-cloud": "../../../node_modules/d3-cloud/build/d3.layout.cloud.js"
        }
    });
    System.import('component/c3-cloud.js').then(function(c3){
        var positiveLinear = d3.scale.linear()
            .domain([ 0, 80267])
            .range(["#9b046b", "#e80c4c"]);
        var negativeLinear = d3.scale.linear()
            .domain([ 0, 80267 ])
            .range(["#3655a7", "#0194d2"]);

        d3.xhr("../../data/cloud/demo.csv?121", function (error, data) {
            var texts = JSON.parse(data.response), currentEle;

            texts = texts.data.map(function(text){
                return {
                    "count": parseInt(text.num),
                    "lemma": text.label_str,
                    "type": text.label_polar.match(/\+/) ? 1 : text.label_polar.match(/\-/) ? -1 : 0
                };
            }).splice(0, 105);

            c3.generate({
                bindto: "#chart",
                padding: {
                  top: 30,
                  left: 0,
                  right: 0,
                  bottom: 30
                },
                "data":{
                    json: texts,
                    keys: {
                        value: ["count", "lemma", "type"]
                    },
                    type: "cloud",
                    onclick: function(d, ele){
                        if(currentEle){
                            currentEle.style.fill = currentEle.getAttribute("data-color");
                        }

                        currentEle = ele;
                        currentEle.setAttribute("data-color", ele.style.fill);

                        ele.style.fill = "#f36b54";
                    }
                },
                "legend":{"show":false},
                cloud: {
                    // ratio: .8,
                    title: {
                        show: false
                    },
                    label: {
                        font: "'Source Han Sans',Helvetica,Tahoma,Arial,'Hiragino Sans GB','Microsoft YaHei',SimSun,Heiti,sans-serif",
                        color: function(d){
                            if(d.type == 1)
                              return positiveLinear(d.count);
                            else if(d.type == -1)
                              return negativeLinear(d.count);
                            else
                              return "#63308d";
                        },
                        highlight: {
                            text: [""],
                            color: "#f36b54"
                        }
                    }
                }
            });
        });
    });
  </script>
  </body>
</html>
