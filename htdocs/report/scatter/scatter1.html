<html>
  <head>
    <link rel="stylesheet" type="text/css" href="../../css/c3.css">
  </head>
  <body>
    <div id="chart"></div>

    <script src="../../js/system.js"></script>
    <script>
      System.defaultJSExtensions = true;
      // set our baseURL reference path
      System.config({
        baseURL: '../../../src/',
        meta: {
            'c3.js': {
            format: 'cjs'
            }
        },
        map: {
            "underscore": "../../../node_modules/underscore/underscore.js",
            "pathseg": "../../../node_modules/pathseg/pathseg.js",
            "d3": "../../../node_modules/d3/d3.js"
        }
    });
      System.import('component/c3-combin.js').then(function(c3){
        function Point(ele) {
          var pos = ele.getAttribute("transform").replace("translate(", "").replace(")", "").split(",");

          return {
            "X": pos[0],
            "Y": pos[1]
          };
        }
        function getDistance( point1, point2 )
        {
          var xs = 0;
          var ys = 0;

          xs = point2.X - point1.X;
          xs = xs * xs;

          ys = point2.Y - point1.Y;
          ys = ys * ys;

          return Math.sqrt( xs + ys );
        }

        var data = {
          "xs":{
              "支持分析平台":"支持分析平台_x",
              "魅蓝销售平台":"魅蓝销售平台_x",
              "魅蓝产品设计部":"魅蓝产品设计部_x",
              "魅蓝Marketing平台":"魅蓝Marketing平台_x",
              "魅蓝产品规划部":"魅蓝产品规划部_x"
          },
          "columns":[
            ["支持分析平台_x",0,26,68],
            ["魅蓝销售平台_x",3,17,24,25,40,46,52,55,70,143,143,161,193,202,213,213],
            ["魅蓝产品设计部_x",47,47],
            ["魅蓝Marketing平台_x",53,62,81,88,111,112,112,164,171,175,182],
            ["魅蓝产品规划部_x",242],
            ["支持分析平台",0.54,0.36,79.18],
            ["魅蓝销售平台",11.42,18.3,2.38,1411.36,32.7,30,0,0.79,10.73,1.13,4.93,1.84,0.43,15.8,0.85,1.75],
            ["魅蓝产品设计部",2.8,2],
            ["魅蓝Marketing平台",33.5,87.1,20,272,510.36,16.83,80,19.08,42.2,1500,5.2],
            ["魅蓝产品规划部",0.79],
            ["支持分析平台_r",750,750,750],
            ["魅蓝销售平台_r",750,750,750,1411.36,750,750,750,750,750,750,750,750,750,750,750,750],
            ["魅蓝产品设计部_r",750,750],
            ["魅蓝Marketing平台_r",750,750,750,750,750,750,750,750,750,1500,750],
            ["魅蓝产品规划部_r",750]
          ]
        };

        var chart = c3.generate({
          transition: {
            enabled: false,
            duration: 1500
          },
          data: {
            ...data,
            // xs: {
            //   "setosa_y": 'setosa_x',
            //   "versicolor_y": 'versicolor_x',
            //   "virginica_y": 'virginica_x'
            // },
            // columns: [
            //   ["setosa_x", 3, 1, 3],
            //   ["setosa_y", 10, 5, 5],
            //   ["setosa", 1, 4, 8],
            //   ["versicolor_x", 4, 4, 5],
            //   ["versicolor_y", 3, 3, 3],
            //   ["versicolor", 2.4, 1.8, 2.5],
            //   ["virginica_x", 3.3, 2.7, 3.0, 2.9, 3.0],
            //   ["virginica_y", 3, 3, 3, 2, 2],
            //   ["virginica", 2.5, 1.9, 2.1, 1.8, 6.2],
            // ],
            type : 'scatter',
            onmouseover: function(d, ele){
              var point = Point(ele);
              var circles = this.query(".c3-circle").filter(function(d){
                var _point = Point(this);
                var dist = getDistance(point, _point);

                return dist < +ele.getAttribute("r") + +this.getAttribute("r");
              });

              console.log(circles.data());
            }
          },
          padding: {
            // right: 10
          },
          axis: {
            x: {
              // min: 3,
              // max: 6,
              label: '日期',
              // "type":"category",
              tick: {
                // fit: false,
                values: ["12-05","12-06","12-07"],
                "format": function(v){
                  if (!v) return 0  // 0时返回0
                  if (parseInt(v) == v) return v  // 整形时,返回原值
                  if (parseFloat(v) == v) return parseFloat(v).toFixed(2)  // 数字时,取2位小数
                  return v;  // 非数字时,返回原值
                }
              }
            },
            y: {
              min: 0,
              label: 'Petal.Width',
              tick: {
                "format": function(v){
                  if (!v) return 0  // 0时返回0
                  if (parseInt(v) == v) return v  // 整形时,返回原值
                  if (parseFloat(v) == v) return parseFloat(v).toFixed(2)  // 数字时,取2位小数
                  return v;  // 非数字时,返回原值
                }
              },
            }
          },
          grid: {
            x: {
              show: true
            },
            y: {
              show: true
            }
          },
          legend: {
            "shape":"square",
            "position": "inset",
            "inset": {
              "step": 1,
              "anchor": "top-right"
            }
          },
          scatter: {
            key: ["setosa", "versicolor", "virginica"],
            symbol: {
              min: 5,
              max: 15
            }
          }
        }, function(){
          this.parser
            .y(["支持分析平台", "魅蓝销售平台", "魅蓝产品设计部", "魅蓝Marketing平台", "魅蓝产品规划部"])
            .other({
              "支持分析平台_x": "支持分析平台",
              "魅蓝销售平台_x": "魅蓝销售平台",
              "魅蓝产品设计部_x": "魅蓝产品设计部",
              "魅蓝Marketing平台_x": "魅蓝Marketing平台",
              "魅蓝产品规划部_x": "魅蓝产品规划部"
            })
        });
      });
    </script>
  </body>
</html>
