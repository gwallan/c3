<html>
  <head>
    <link rel="stylesheet" type="text/css" href="../../css/c3.css">
    <style>
      .c3-grid line{
        stroke: #F44336;
      }
      .c3-xgrids .c3-xgrid:first-child{
        opacity: 1!important;
      }
    </style>
  </head>
  <body>
    <div id="chart"></div>

    <script src="../../js/system.js"></script>
    <script>
      System.defaultJSExtensions = true;
      // set our baseURL reference path
      System.config({
        baseURL: '../../../src/',
        meta: {
            'c3.js': {
            format: 'cjs'
            }
        },
        map: {
            "underscore": "../../../node_modules/underscore/underscore.js",
            "pathseg": "../../../node_modules/pathseg/pathseg.js",
            "d3": "../../../node_modules/d3/d3.js"
        }
    });
      System.import('component/c3-combin.js').then(function(c3){
        function Point(ele) {
          var pos = ele.getAttribute("transform").replace("translate(", "").replace(")", "").split(",");

          return {
            "X": pos[0],
            "Y": pos[1]
          };
        }
        function getDistance( point1, point2 )
        {
          var xs = 0;
          var ys = 0;

          xs = point2.X - point1.X;
          xs = xs * xs;

          ys = point2.Y - point1.Y;
          ys = ys * ys;

          return Math.sqrt( xs + ys );
        }

        var data = {
          "xs":{
            "魅蓝Marketing平台":"魅蓝Marketing平台_x",
            "魅蓝品牌管理部":"魅蓝品牌管理部_x",
            "魅蓝事业部":"魅蓝事业部_x",
            "支持分析平台":"支持分析平台_x"
          },
          "columns":[
            ["魅蓝Marketing平台",0.29,12111.11,2],
            ["魅蓝Marketing平台_x",0,4,390],
            ["魅蓝Marketing平台_r",6055.555,12111.11,6055.555],
            ["魅蓝品牌管理部",0],
            ["魅蓝品牌管理部_x",154],
            ["魅蓝品牌管理部_r",6055.555],
            ["魅蓝事业部",0],
            ["魅蓝事业部_x",155],
            ["魅蓝事业部_r",6055.555],
            ["支持分析平台",11.11],
            ["支持分析平台_x",344],
            ["支持分析平台_r",6055.555]
          ],
          "type":"scatter"
        };

        var chart = c3.generate({
          transition: {
            enabled: false,
            duration: 1500
          },
          data: {
            ...data,
            // xs: {
            //   "setosa_y": 'setosa_x',
            //   "versicolor_y": 'versicolor_x',
            //   "virginica_y": 'virginica_x'
            // },
            // columns: [
            //   ["setosa_x", 3, 1, 3],
            //   ["setosa_y", 10, 5, 5],
            //   ["setosa", 1, 4, 8],
            //   ["versicolor_x", 4, 4, 5],
            //   ["versicolor_y", 3, 3, 3],
            //   ["versicolor", 2.4, 1.8, 2.5],
            //   ["virginica_x", 3.3, 2.7, 3.0, 2.9, 3.0],
            //   ["virginica_y", 3, 3, 3, 2, 2],
            //   ["virginica", 2.5, 1.9, 2.1, 1.8, 6.2],
            // ],
            type : 'scatter',
            onmouseover: function(d, ele){
              var point = Point(ele);
              var circles = this.query(".c3-circle").filter(function(d){
                var _point = Point(this);
                var dist = getDistance(point, _point);

                return dist < +ele.getAttribute("r") + +this.getAttribute("r");
              });

              console.log(circles.data());
            }
          },
          padding: {
            left: 20,
            right: 20,
            top: 10
          },
          axis: {
            x: {
              min: 0,
              // max: 6,
              // label: '日期',
              // "type":"category",
              padding: {
                right: 0
              },
              tick: {
                mark: true,
                count: 7,
                padding: 15
                // fit: false,
                // values: ["12-05","12-06","12-07"],
                // "format": function(v){
                //   if (!v) return 0  // 0时返回0
                //   if (parseInt(v) == v) return v  // 整形时,返回原值
                //   if (parseFloat(v) == v) return parseFloat(v).toFixed(2)  // 数字时,取2位小数
                //   return v;  // 非数字时,返回原值
                // }
              }
            },
            y: {
              show: false,
              min: 0,
              label: 'Petal.Width',
              tick: {
                "format": function(v){
                  if (!v) return 0  // 0时返回0
                  if (parseInt(v) == v) return v  // 整形时,返回原值
                  if (parseFloat(v) == v) return parseFloat(v).toFixed(2)  // 数字时,取2位小数
                  return v;  // 非数字时,返回原值
                }
              },
            }
          },
          grid: {
            x: {
              show: true,
              type: 'tick'
            },
            y: {
              show: true
            }
          },
          legend: {
            "shape":"square",
            "position": "inset",
            "inset": {
              "step": 1,
              "anchor": "top-right"
            }
          },
          scatter: {
            symbol: {
              min: 5,
              max: 15
            }
          }
        }, function(){
          this.parser
            .y(["支持分析平台", "魅蓝品牌管理部", "魅蓝Marketing平台", "魅蓝事业部"])
            .other({
              "支持分析平台_x": "支持分析平台",
              "魅蓝品牌管理部_x": "魅蓝品牌管理部",
              "魅蓝Marketing平台_x": "魅蓝Marketing平台",
              "魅蓝事业部_x": "魅蓝事业部"
            })
        });
      });
    </script>
  </body>
</html>
